#!/bin/bash

echo "ğŸš€ Starting Phase V Environment"

# Start Kafka
echo "ğŸ“¦ Starting Kafka..."
docker-compose -f docker-compose.kafka.yml up -d
sleep 20

# Start Minikube
echo "â˜¸ï¸  Starting Minikube..."
minikube start --driver=docker --cpus=4 --memory=8192
minikube addons enable ingress

# Install Dapr
echo "ğŸ”· Installing Dapr..."
dapr init --kubernetes --wait

# Deploy application
echo "ğŸš€ Deploying application..."
kubectl create namespace todo-app
kubectl apply -f k8s/

# Start Kafka consumers
echo "ğŸ‘‚ Starting Kafka consumers..."
cd backend
source venv/bin/activate
python recurring_task_consumer.py &
python reminder_consumer.py &

echo "âœ… Phase V environment ready!"
echo "ğŸ“Š Kafka UI: http://localhost:8090"
echo "ğŸŒ App: $(minikube service todo-frontend-service -n todo-app --url)"
